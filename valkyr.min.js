// ==========================================================================
// Project:   Valkyr.js - The power of judgment over your forms!
// Copyright: Copyright 2014 Lukas Alexandre
// License:   Licensed under MIT license
//            See https://github.com/lukelex/valkyr.js/blob/master/LICENSE
// ==========================================================================

// Version: 0.2.2 | From: 08-03-2014

window.valkyr={customRules:{}},function(){function a(a){function c(a){return a?b(a):{check:function(){return{isOk:!0}}}}function d(b,c){return a.inheritanceRule.check(b,c).isOk&&a.validator(c)}function e(b){var c=a.message;return window.valkyr.translations&&(console.warn(a.name),c=window.valkyr.translations[a.name]),c.replace(/\%s/,b)}return a.inheritanceRule=c(a.inherits),a.setParams=function(){return a},a.getExtraInfo=function(){return a},a.check=function(a,b){var c={isOk:d(a,b)};return c.isOk||(c.message=e(a)),c},a}function b(a){var b=window.valkyr.predefinedRules.find(a)||window.valkyr.customRules[a];if(!b)throw"Rule "+a+" does not exist!";return b}window.valkyr.rule=a,window.buildRule=a.build=function(b){var c=a(b);return window.valkyr.customRules[b.name]=c,c},a.retrieve=b}(),window.valkyr.comparisonRule=function(a){var b=window.valkyr.rule(a);return b.setParams=function(a){return b.params=a,b},b.check=function(a,c){var d={isOk:b.validator(c,b.comparedTo.value)};return d.isOk||(d.message=b.message.replace(/\%s/,a),d.message=d.message.replace(/\%s/,b.params)),d},b.getExtraInfo=function(a){return b.comparedTo=a[b.params],b},b},window.valkyr.parameterRule=function(a){var b=window.valkyr.rule(a);return b.setParams=function(a){return b.params=a,b},b.check=function(a,c){var d={isOk:b.validator(c,b.params)};return d.isOk||(d.message=b.message.replace(/\%s/,a),d.message=d.message.replace(/\%s/,b.params)),d},b},window.validator=window.valkyr.validator=function(a,b){function c(){for(var c=b.length;c--;)k.push(window.valkyr.constraint(a,b[c]))}function d(){var a=!1;return b.validate(),a=0===Object.keys(b.errors).length,a||l(b.errors),a}function e(){j=a.onsubmit,a.onsubmit=function(a){return d()?!!j&&j(a):void f(a)}}function f(a){a&&a.preventDefault?a.preventDefault():window.event&&(window.event.returnValue=!1)}function g(a,c){var d;c||(c=i(a)),d=c.validate(),d.errors.length>0?b.errors[d.name]=d.errors:delete b.errors[d.name]}function h(){var a=k.length;for(b.errors={};a--;)g(null,k[a])}function i(a){for(var b=k.length;b--;)if(k[b].field()==a)return k[b]}if(!a)throw"Missing form";if(!b)throw"Missing constraints";if(!(b instanceof Array))throw"Constraints must be an array";var j,k=[],l=function(){};return b.errors={},c(),e(),b.validate=function(a){a?g(a):h()},b.submit=function(a){return a&&a.skipValidations===!0||b.isValid()?void(j&&j()):!1},b.onError=function(a){return l=a,b},b.isValid=d,b},window.valkyr.constraint=function(a,b){function c(){if(g())return j.checked;if(h())for(var a=j.length;a--;)if(j[a].checked)return j[a].value;return j.value}function d(){for(var a=f(),b=a.length,c={};b--;){var d=a[b];if(Object.prototype.hasOwnProperty.call(c,d))throw"Duplicate rule declaration!";c[d]=!0}}function e(){for(var b=f(),c=b.length;c--;)i.push(window.valkyr.rule.retrieve(b[c]).getExtraInfo(a))}function f(){return b.rules.split("|")}function g(){return"INPUT"===j.nodeName&&"checkbox"===j.type}function h(){return j instanceof window.NodeList?"INPUT"===j[0].nodeName&&"radio"===j[0].type:!1}d();var i=[],j=a[b.name];return e(),b.field=function(){return j},b.validate=function(){for(var a,d={name:b.name,errors:[]},e=i.length;e--;)a=i[e].check(b.as||b.name,c()),a.isOk||d.errors.push(a.message);return d},b},function(){function a(a){var b=a.match(/\[(.+?)\]$/);return b&&(b=b[1]),{name:a.match(/^.+?(?=\[.+?\])/)||a,params:b}}var b={},c={find:function(c){var d,e;return d=a(c),(e=b[d.name])&&e.setParams(d.params),e}};window.valkyr.predefinedRules=c,b.minLength=window.valkyr.parameterRule({name:"minLength",message:"The %s field must be at least %s characters in length.",validator:function(a,b){return a.length>=b}}),b.maxLength=window.valkyr.parameterRule({name:"maxLength",message:"The %s field must not exceed %s characters in length.",validator:function(a,b){return a.length<=b}}),b.exactLength=window.valkyr.parameterRule({name:"exactLength",message:"The %s field must be exactly %s characters in length.",validator:function(a,b){return a.length===b}}),b.required=window.valkyr.rule({name:"required",message:"The %s field can't be empty.",validator:function(a){return a&&a!==!1?a===!0?!0:a.length>0:!1}}),b.email=window.valkyr.rule({name:"emailFormat",inherits:"required",message:"The %s field must contain a valid email address.",validator:function(a){return!!a.match(/^([0-9a-zA-Z]([-\.\w]*[0-9a-zA-Z])*@([0-9a-zA-Z][-\w]*[0-9a-zA-Z]\.)+[a-zA-Z]{2,9})$/)}}),b.url=window.valkyr.rule({name:"url",inherits:"required",message:"The %s field must contain a valid URL.",validator:function(a){return!!a.match(/^((http|https):\/\/(\w+:{0,1}\w*@)?(\S+)|)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/)}}),b.numeric=window.valkyr.rule({name:"number",message:"The %s field must be a number.",validator:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}}),b.integer=window.valkyr.rule({name:"integer",inherits:"numeric",message:"The %s field must contain an integer.",validator:function(a){return!!a.match(/^\-?[0-9]+$/)}}),b.decimal=window.valkyr.rule({name:"decimal",inherits:"numeric",message:"The %s field must contain a decimal number.",validator:function(a){return!!a.match(/^\-?[0-9]*\.[0-9]+$/)}}),b.natural=window.valkyr.rule({name:"natural",inherits:"numeric",message:"The %s field must contain only positive numbers.",validator:function(a){return!!a.match(/^[0-9]+$/i)}}),b.alphabetical=window.valkyr.rule({name:"alphabetical",inherits:"required",message:"The %s field must only contain alphabetical characters.",validator:function(a){return!!a.match(/^[a-z]+$/i)}}),b.equals=window.valkyr.comparisonRule({name:"equals",inherits:"required",message:"The %s field needs to be equal to %s field.",validator:function(a,b){return a===b}}),b["credit-card"]=window.valkyr.rule({name:"creditCardNumber",inherits:"required",message:"The %s field doesn't have a valid credit-card number.",validator:function(a){var b,c,d,e;for(b=a.length,c=0,d=[[0,1,2,3,4,5,6,7,8,9],[0,2,4,6,8,1,3,5,7,9]],e=0;b--;)e+=d[c][parseInt(a.charAt(b),10)],c^=1;return e%10===0&&e>0}}),b.ip=window.valkyr.rule({name:"IP",inherits:"required",message:"The %s field must contain a valid IP.",validator:function(a){return!!a.match(/^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$/i)}})}();