// ==========================================================================
// Project:   Valkyr.js - The power of judgment over your forms!
// Copyright: Copyright 2014 Lukas Alexandre
// License:   Licensed under MIT license
//            See https://github.com/lukelex/valkyr.js/blob/master/LICENSE
// ==========================================================================

// Version: 0.2.1 | From: 20-02-2014

window.valkyr={customRules:{}},function(){Function.prototype.method=function(a,b){return this.hasOwnProperty(a)?void 0:(this.prototype[a]=b,this)}}(),function(){function a(a){this.$$name=a.name,this.$$message=a.message,this.$$validator=a.validator,this.$$inheritanceRule=b(a.inherits)}function b(b){return b?a.$retrieve(b):{$check:function(){return{isOk:!0}}}}a.$retrieve=function(a){var b=window.valkyr.predefinedRules.$find(a)||window.valkyr.customRules[a];if(!b)throw"Rule "+a+" does not exist!";return b},a.build=function(b){var c=new a(b);return window.valkyr.customRules[b.name]=c,c},a.method("$params",function(){return this}),a.method("$getExtraInfo",function(){return this}),a.method("$check",function(a,b){var c={isOk:this.$checkWithHierarchy(a,b)};return c.isOk||(c.message=this.$$message.replace(/\%s/,a)),c}),a.method("$checkWithHierarchy",function(a,b){return this.$$inheritanceRule.$check(a,b).isOk&&this.$$validator(b)}),window.valkyr.Rule=a}(),function(){function a(a){window.valkyr.Rule.call(this,a)}a.prototype=Object.create(window.valkyr.Rule.prototype),a.prototype.constructor=a,a.method("$params",function(a){return this.$$params=a,this}),a.method("$check",function(a,b){var c={isOk:this.$$validator(b,this.$$comparedTo.value)};return c.isOk||(c.message=this.$$message.replace(/\%s/,a),c.message=c.message.replace(/\%s/,this.$$params)),c}),a.method("$getExtraInfo",function(a){return this.$$comparedTo=a[this.$$params],this}),window.valkyr.ComparisonRule=a}(),function(){function a(a){window.valkyr.Rule.call(this,a)}a.prototype=Object.create(window.valkyr.Rule.prototype),a.prototype.constructor=a,a.method("$params",function(a){return this.$$params=a,this}),a.method("$check",function(a,b){var c={isOk:this.$$validator(b,this.$$params)};return c.isOk||(c.message=this.$$message.replace(/\%s/,a),c.message=c.message.replace(/\%s/,this.$$params)),c}),window.valkyr.ParameterRule=a}(),function(){function a(a,c){if(!a)throw"Missing form";if(!c)throw"Missing constraints";if(!(c instanceof Array))throw"Constraints must be an array";this.$$form=a,this.$$constraints=b(a,c),this.errors={},this.$setupSubmission()}function b(a,b){var c,d;for(c=[],d=b.length;d--;)c.push(new window.valkyr.Constraint(a,b[d]));return c}function c(a){a&&a.preventDefault?a.preventDefault():window.event&&(window.event.returnValue=!1)}a.method("$setupSubmission",function(){this.$$originalSubmit=this.$$form.onsubmit,this.$$form.onsubmit=function(a){return function(b){return a.isValid()?!!a.$$originalSubmit&&a.$$originalSubmit(b):void c(b)}}(this)}),a.method("validate",function(a){a?this.$validateField(a):this.$validateAllFields()}),a.method("$validateField",function(a,b){var c;b||(b=this.$constraintFor(a)),c=b.$validate(),c.errors.length>0?this.errors[c.name]=c.errors:delete this.errors[c.name]}),a.method("$validateAllFields",function(){var a;for(this.errors={},a=this.$$constraints.length;a--;)this.$validateField(null,this.$$constraints[a])}),a.method("$constraintFor",function(a){for(var b=this.$$constraints.length;b--;)if(this.$$constraints[b].$$field==a)return this.$$constraints[b]}),a.method("isValid",function(){var a=!1;return this.validate(),a=0===Object.keys(this.errors).length,!a&&this.$$onError&&this.$$onError(this.errors),a}),a.method("submit",function(a){return a&&a.skipValidations===!0||this.isValid()?void(this.$$originalSubmit&&this.$$originalSubmit()):!1}),a.method("onError",function(a){return this.$$onError=a,this}),window.valkyr.Validator=a}(),function(){function a(a,e){b(e.rules.split(g)),this.$$as=e.as,this.$$name=e.name,this.$$field=c(a,this.$$name),this.$$rules=d(e.rules,a)}function b(a){var b,c={};for(b=a.length;b--;){var d=a[b];if(Object.prototype.hasOwnProperty.call(c,d))throw"Duplicate rule declaration!";c[d]=!0}}function c(a,b){return a[b]}function d(a,b){var c,d,e;for(d=a.split(g),e=[],c=d.length;c--;)e.push(window.valkyr.Rule.$retrieve(d[c]).$getExtraInfo(b));return e}function e(a){return"INPUT"===a.nodeName&&"checkbox"===a.type}function f(a){return a instanceof window.NodeList?"INPUT"===a[0].nodeName&&"radio"===a[0].type:!1}var g="|";a.method("$validate",function(){var a,b,c;for(b={name:this.$$name,errors:[]},a=this.$$rules.length;a--;)c=this.$$rules[a].$check(this.$$as||this.$$name,this.$value()),c.isOk||b.errors.push(c.message);return b}),a.method("$value",function(){if(e(this.$$field))return this.$$field.checked;if(f(this.$$field))for(var a=this.$$field.length;a--;)if(this.$$field[a].checked)return this.$$field[a].value;return this.$$field.value}),window.valkyr.Constraint=a}(),function(){function a(a){var b=a.match(/\[(.+?)\]$/);return b&&(b=b[1]),{name:a.match(/^.+?(?=\[.+?\])/)||a,params:b}}var b={},c={$find:function(c){var d,e;return d=a(c),(e=b[d.name])&&e.$params(d.params),e}};window.valkyr.predefinedRules=c,b.minLength=new window.valkyr.ParameterRule({name:"minLength",message:"The %s field must be at least %s characters in length.",validator:function(a,b){return a.length>=b}}),b.maxLength=new window.valkyr.ParameterRule({name:"maxLength",message:"The %s field must not exceed %s characters in length.",validator:function(a,b){return a.length<=b}}),b.exactLength=new window.valkyr.ParameterRule({name:"exactLength",message:"The %s field must be exactly %s characters in length.",validator:function(a,b){return a.length===b}}),b.required=new window.valkyr.Rule({name:"required",message:"The %s field can't be empty.",validator:function(a){return a&&a!==!1?a===!0?!0:a.length>0:!1}}),b.email=new window.valkyr.Rule({name:"emailFormat",inherits:"required",message:"The %s field must contain a valid email address.",validator:function(a){return!!a.match(/^([0-9a-zA-Z]([-\.\w]*[0-9a-zA-Z])*@([0-9a-zA-Z][-\w]*[0-9a-zA-Z]\.)+[a-zA-Z]{2,9})$/)}}),b.url=new window.valkyr.Rule({name:"url",inherits:"required",message:"The %s field must contain a valid URL.",validator:function(a){return!!a.match(/^((http|https):\/\/(\w+:{0,1}\w*@)?(\S+)|)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/)}}),b.numeric=new window.valkyr.Rule({name:"number",message:"The %s field must be a number.",validator:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}}),b.integer=new window.valkyr.Rule({name:"integer",inherits:"numeric",message:"The %s field must contain an integer.",validator:function(a){return!!a.match(/^\-?[0-9]+$/)}}),b.decimal=new window.valkyr.Rule({name:"decimal",inherits:"numeric",message:"The %s field must contain a decimal number.",validator:function(a){return!!a.match(/^\-?[0-9]*\.[0-9]+$/)}}),b.natural=new window.valkyr.Rule({name:"natural",inherits:"numeric",message:"The %s field must contain only positive numbers.",validator:function(a){return!!a.match(/^[0-9]+$/i)}}),b.alphabetical=new window.valkyr.Rule({name:"alphabetical",inherits:"required",message:"The %s field must only contain alphabetical characters.",validator:function(a){return!!a.match(/^[a-z]+$/i)}}),b.equals=new window.valkyr.ComparisonRule({name:"equals",inherits:"required",message:"The %s field needs to be equal to %s field.",validator:function(a,b){return a===b}}),b["credit-card"]=new window.valkyr.Rule({name:"creditCardNumber",inherits:"required",message:"The %s field doesn't have a valid credit-card number.",validator:function(a){var b,c,d,e;for(b=a.length,c=0,d=[[0,1,2,3,4,5,6,7,8,9],[0,2,4,6,8,1,3,5,7,9]],e=0;b--;)e+=d[c][parseInt(a.charAt(b),10)],c^=1;return e%10===0&&e>0}}),b.ip=new window.valkyr.Rule({name:"IP",inherits:"required",message:"The %s field must contain a valid IP.",validator:function(a){return!!a.match(/^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$/i)}})}(),function(){window.Validator=window.valkyr.Validator}();