// ==========================================================================
// Project:   Valkyr.js - The power of judgment over your forms!
// Copyright: Copyright 2014 Lukas Alexandre
// License:   Licensed under MIT license
//            See https://github.com/lukelex/valkyr.js/blob/master/LICENSE
// ==========================================================================

// Version: 0.2.1 | From: 24-02-2014

window.valkyr={customRules:{}},function(){Function.prototype.method=function(a,b){return this.hasOwnProperty(a)?void 0:(this.prototype[a]=b,this)}}(),function(){function a(a){function b(){return a}function d(){return a}function e(b,c){var d={isOk:g(b,c)};return d.isOk||(d.message=a.message.replace(/\%s/,b)),d}function f(a){return a?c(a):{check:function(){return{isOk:!0}}}}function g(b,c){return a.inheritanceRule.check(b,c).isOk&&a.validator(c)}return a.inheritanceRule=f(a.inherits),a.setParams=b,a.getExtraInfo=d,a.check=e,a}function b(b){var c=a(b);return window.valkyr.customRules[b.name]=c,c}function c(a){var b=window.valkyr.predefinedRules.$find(a)||window.valkyr.customRules[a];if(!b)throw"Rule "+a+" does not exist!";return b}window.valkyr.rule=a,a.build=b,a.retrieve=c}(),window.valkyr.comparisonRule=function(a){function b(a){return e.params=a,e}function c(a,b){var c={isOk:e.validator(b,e.comparedTo.value)};return c.isOk||(c.message=e.message.replace(/\%s/,a),c.message=c.message.replace(/\%s/,e.params)),c}function d(a){return e.comparedTo=a[e.params],e}var e=window.valkyr.rule(a);return e.setParams=b,e.check=c,e.getExtraInfo=d,e},window.valkyr.parameterRule=function(a){function b(a){return d.params=a,d}function c(a,b){var c={isOk:d.validator(b,d.params)};return c.isOk||(c.message=d.message.replace(/\%s/,a),c.message=c.message.replace(/\%s/,d.params)),c}var d=window.valkyr.rule(a);return d.setParams=b,d.check=c,d},window.valkyr.validator=function(a,b){function c(){for(var c=b.length;c--;)m.push(window.valkyr.constraint(a,b[c]))}function d(){n=a.onsubmit,a.onsubmit=function(a){return j()?!!n&&n(a):void e(a)}}function e(a){a&&a.preventDefault?a.preventDefault():window.event&&(window.event.returnValue=!1)}function f(a){a?g(a):h()}function g(a,c){var d;c||(c=i(a)),d=c.validate(),d.errors.length>0?b.errors[d.name]=d.errors:delete b.errors[d.name]}function h(){var a;for(b.errors={},a=m.length;a--;)g(null,m[a])}function i(a){for(var b=m.length;b--;)if(m[b].field()==a)return m[b]}function j(){var a=!1;return b.validate(),a=0===Object.keys(b.errors).length,a||l(b.errors),a}function k(a){return a&&a.skipValidations===!0||b.isValid()?void(n&&n()):!1}function l(a){return l=a,b}if(!a)throw"Missing form";if(!b)throw"Missing constraints";if(!(b instanceof Array))throw"Constraints must be an array";var m,n;return b.errors={},m=[],c(),d(),l=function(){},b.validate=f,b.isValid=j,b.submit=k,b},window.valkyr.constraint=function(a,b){function c(){var a,c,e;for(c={name:b.name,errors:[]},a=j.length;a--;)e=j[a].check(b.as||b.name,d()),e.isOk||c.errors.push(e.message);return c}function d(){if(h())return k.checked;if(i())for(var a=k.length;a--;)if(k[a].checked)return k[a].value;return k.value}function e(){var a,b,c={};for(b=g(),a=b.length;a--;){var d=b[a];if(Object.prototype.hasOwnProperty.call(c,d))throw"Duplicate rule declaration!";c[d]=!0}}function f(){var b,c;for(c=g(),b=c.length;b--;)j.push(window.valkyr.rule.retrieve(c[b]).getExtraInfo(a))}function g(){return b.rules.split("|")}function h(){return"INPUT"===k.nodeName&&"checkbox"===k.type}function i(){return k instanceof window.NodeList?"INPUT"===k[0].nodeName&&"radio"===k[0].type:!1}var j,k;return e(),j=[],f(),k=a[b.name],b.field=function(){return k},b.validate=c,b},function(){function a(a){var b=a.match(/\[(.+?)\]$/);return b&&(b=b[1]),{name:a.match(/^.+?(?=\[.+?\])/)||a,params:b}}var b={},c={$find:function(c){var d,e;return d=a(c),(e=b[d.name])&&e.setParams(d.params),e}};window.valkyr.predefinedRules=c,b.minLength=window.valkyr.parameterRule({name:"minLength",message:"The %s field must be at least %s characters in length.",validator:function(a,b){return a.length>=b}}),b.maxLength=window.valkyr.parameterRule({name:"maxLength",message:"The %s field must not exceed %s characters in length.",validator:function(a,b){return a.length<=b}}),b.exactLength=window.valkyr.parameterRule({name:"exactLength",message:"The %s field must be exactly %s characters in length.",validator:function(a,b){return a.length===b}}),b.required=window.valkyr.rule({name:"required",message:"The %s field can't be empty.",validator:function(a){return a&&a!==!1?a===!0?!0:a.length>0:!1}}),b.email=window.valkyr.rule({name:"emailFormat",inherits:"required",message:"The %s field must contain a valid email address.",validator:function(a){return!!a.match(/^([0-9a-zA-Z]([-\.\w]*[0-9a-zA-Z])*@([0-9a-zA-Z][-\w]*[0-9a-zA-Z]\.)+[a-zA-Z]{2,9})$/)}}),b.url=window.valkyr.rule({name:"url",inherits:"required",message:"The %s field must contain a valid URL.",validator:function(a){return!!a.match(/^((http|https):\/\/(\w+:{0,1}\w*@)?(\S+)|)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/)}}),b.numeric=window.valkyr.rule({name:"number",message:"The %s field must be a number.",validator:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}}),b.integer=window.valkyr.rule({name:"integer",inherits:"numeric",message:"The %s field must contain an integer.",validator:function(a){return!!a.match(/^\-?[0-9]+$/)}}),b.decimal=window.valkyr.rule({name:"decimal",inherits:"numeric",message:"The %s field must contain a decimal number.",validator:function(a){return!!a.match(/^\-?[0-9]*\.[0-9]+$/)}}),b.natural=window.valkyr.rule({name:"natural",inherits:"numeric",message:"The %s field must contain only positive numbers.",validator:function(a){return!!a.match(/^[0-9]+$/i)}}),b.alphabetical=window.valkyr.rule({name:"alphabetical",inherits:"required",message:"The %s field must only contain alphabetical characters.",validator:function(a){return!!a.match(/^[a-z]+$/i)}}),b.equals=window.valkyr.comparisonRule({name:"equals",inherits:"required",message:"The %s field needs to be equal to %s field.",validator:function(a,b){return a===b}}),b["credit-card"]=window.valkyr.rule({name:"creditCardNumber",inherits:"required",message:"The %s field doesn't have a valid credit-card number.",validator:function(a){var b,c,d,e;for(b=a.length,c=0,d=[[0,1,2,3,4,5,6,7,8,9],[0,2,4,6,8,1,3,5,7,9]],e=0;b--;)e+=d[c][parseInt(a.charAt(b),10)],c^=1;return e%10===0&&e>0}}),b.ip=window.valkyr.rule({name:"IP",inherits:"required",message:"The %s field must contain a valid IP.",validator:function(a){return!!a.match(/^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$/i)}})}(),function(){window.validator=window.valkyr.validator,window.buildRule=window.valkyr.rule.build}();